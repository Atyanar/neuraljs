"use strict";!function(r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():window.typed=r()}(function(){function r(){function n(r){for(var n,e=0;e<A.types.length;e++){var t=A.types[e];if(t.name===r){n=t.test;break}}if(!n){var s;for(e=0;e<A.types.length;e++)if(t=A.types[e],t.name.toLowerCase()==r.toLowerCase()){s=t.name;break}throw new Error('Unknown type "'+r+'"'+(s?'. Did you mean "'+s+'"?':""))}return n}function e(r){for(var n="",e=0;e<r.length;e++){var t=r[e];if(""!=t.name)if(""==n)n=t.name;else if(n!=t.name){var s=new Error("Function names do not match (expected: "+n+", actual: "+t.name+")");throw s.data={actual:t.name,expected:n},s}}return n}function t(r,n,e,t,s){var o,i=v(t),a=s?s.split(","):null,p=r||"unnamed",u=a&&l(a,"any"),h={fn:r,index:e,actual:t,expected:a};o=a?n>e&&!u?"Unexpected type of argument in function "+p+" (expected: "+a.join(" or ")+", actual: "+i+", index: "+e+")":"Too few arguments in function "+p+" (expected: "+a.join(" or ")+", index: "+e+")":"Too many arguments in function "+p+" (expected: "+e+", actual: "+n+")";var f=new TypeError(o);return f.data=h,f}function s(r){this.name=r||"refs",this.categories={}}function o(r,n){if("string"==typeof r){var e=r.trim(),t="..."===e.substr(0,3);if(t&&(e=e.substr(3)),""===e)this.types=["any"];else{this.types=e.split("|");for(var s=0;s<this.types.length;s++)this.types[s]=this.types[s].trim()}}else{if(!Array.isArray(r)){if(r instanceof o)return r.clone();throw new Error("String or Array expected")}this.types=r}this.conversions=[],this.varArgs=t||n||!1,this.anyType=-1!==this.types.indexOf("any")}function i(r,n){var e;if("string"==typeof r)e=""!==r?r.split(","):[];else{if(!Array.isArray(r))throw new Error("string or Array expected");e=r}this.params=new Array(e.length);for(var t=0;t<e.length;t++){var s=new o(e[t]);if(this.params[t]=s,t===e.length-1)this.varArgs=s.varArgs;else if(s.varArgs)throw new SyntaxError('Unexpected variable arguments operator "..."')}this.fn=n}function a(r,n,e){this.path=r||[],this.param=r[r.length-1]||null,this.signature=n||null,this.childs=e||[]}function p(r){var n,e,t={},s=[];for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];if(n=new i(o,a),n.ignore())continue;var p=n.expand();for(e=0;e<p.length;e++){var u=p[e],h=u.toString(),f=t[h];if(f){var c=i.compare(u,f);if(0>c)t[h]=u;else if(0===c)throw new Error('Signature "'+h+'" is defined twice')}else t[h]=u}}for(h in t)t.hasOwnProperty(h)&&s.push(t[h]);for(s.sort(function(r,n){return i.compare(r,n)}),e=0;e<s.length;e++)if(n=s[e],n.varArgs)for(var g=n.params.length-1,v=n.params[g],y=0;y<v.types.length;){if(v.conversions[y])for(var m=v.types[y],d=0;d<s.length;d++){var w=s[d],x=w.params[g];if(w!==n&&x&&l(x.types,m)&&!x.conversions[g]){v.types.splice(y,1),v.conversions.splice(y,1),y--;break}}y++}return s}function u(r){for(var n={},e=0;e<r.length;e++){var t=r[e];if(t.fn&&!t.hasConversions()){var s=t.params.join(",");n[s]=t.fn}}return n}function h(r,n){var e,t,s,i=n.length,p=[];for(e=0;e<r.length;e++)t=r[e],t.params.length!==i||s||(s=t),void 0!=t.params[i]&&p.push(t);p.sort(function(r,n){return o.compare(r.params[i],n.params[i])});var u=[];for(e=0;e<p.length;e++){t=p[e];var f=t.params[i],c=u.filter(function(r){return r.param.overlapping(f)})[0];if(c){if(c.param.varArgs)throw new Error('Conflicting types "'+c.param+'" and "'+f+'"');c.signatures.push(t)}else u.push({param:f,signatures:[t]})}var g=new Array(u.length);for(e=0;e<u.length;e++){var v=u[e];g[e]=h(v.signatures,n.concat(v.param))}return new a(n,s,g)}function f(r){for(var n=[],e=0;r>e;e++)n[e]="arg"+e;return n}function c(r,n){var e=new s,o=p(n);if(0==o.length)throw new Error("No signatures provided");var i=h(o,[]),a=[],c=r||"",v=f(g(o));a.push("function "+c+"("+v.join(", ")+") {"),a.push('  "use strict";'),a.push("  var name = '"+c+"';"),a.push(i.toCode(e,"  ")),a.push("}");var l=[e.toCode(),"return "+a.join("\n")].join("\n"),y=new Function(e.name,"createError",l),m=y(e,t);return m.signatures=u(o),m}function g(r){for(var n=0,e=0;e<r.length;e++){var t=r[e].params.length;t>n&&(n=t)}return n}function v(r){for(var n,e=0;e<A.types.length;e++){var t=A.types[e];if("Object"===t.name)n=t;else if(t.test(r))return t.name}return n&&n.test(r)?n.name:"unknown"}function l(r,n){return-1!==r.indexOf(n)}function y(r,n){if(!r.signatures)throw new TypeError("Function is no typed-function");var e;if("string"==typeof n){e=n.split(",");for(var t=0;t<e.length;t++)e[t]=e[t].trim()}else{if(!Array.isArray(n))throw new TypeError("String array or a comma separated string expected");e=n}var s=e.join(","),o=r.signatures[s];if(o)return o;throw new TypeError("Signature not found (signature: "+(r.name||"unnamed")+"("+e.join(", ")+"))")}function m(r,n){var e=v(r);if(n===e)return r;for(var t=0;t<A.conversions.length;t++){var s=A.conversions[t];if(s.from===e&&s.to===n)return s.convert(r)}throw new Error("Cannot convert from "+e+" to "+n)}s.prototype.add=function(r,n){var e=n||"fn";this.categories[e]||(this.categories[e]=[]);var t=this.categories[e].indexOf(r);return-1==t&&(t=this.categories[e].length,this.categories[e].push(r)),e+t},s.prototype.toCode=function(){var r=[],n=this.name+".categories",e=this.categories;for(var t in e)if(e.hasOwnProperty(t))for(var s=e[t],o=0;o<s.length;o++)r.push("var "+t+o+" = "+n+"['"+t+"']["+o+"];");return r.join("\n")},o.compare=function(r,n){if(r.anyType)return 1;if(n.anyType)return-1;if(l(r.types,"Object"))return 1;if(l(n.types,"Object"))return-1;if(r.hasConversions()){if(n.hasConversions()){var e,t,s;for(e=0;e<r.conversions.length;e++)if(void 0!==r.conversions[e]){t=r.conversions[e];break}for(e=0;e<n.conversions.length;e++)if(void 0!==n.conversions[e]){s=n.conversions[e];break}return A.conversions.indexOf(t)-A.conversions.indexOf(s)}return 1}if(n.hasConversions())return-1;var o,i;for(e=0;e<A.types.length;e++)if(A.types[e].name===r.types[0]){o=e;break}for(e=0;e<A.types.length;e++)if(A.types[e].name===n.types[0]){i=e;break}return o-i},o.prototype.overlapping=function(r){for(var n=0;n<this.types.length;n++)if(l(r.types,this.types[n]))return!0;return!1},o.prototype.clone=function(){var r=new o(this.types.slice(),this.varArgs);return r.conversions=this.conversions.slice(),r},o.prototype.hasConversions=function(){return this.conversions.length>0},o.prototype.contains=function(r){for(var n=0;n<this.types.length;n++)if(r[this.types[n]])return!0;return!1},o.prototype.toString=function(r){for(var n=[],e={},t=0;t<this.types.length;t++){var s=this.conversions[t],o=r&&s?s.to:this.types[t];o in e||(e[o]=!0,n.push(o))}return(this.varArgs?"...":"")+n.join("|")},i.prototype.clone=function(){return new i(this.params.slice(),this.fn)},i.prototype.expand=function(){function r(e,t){if(t.length<e.params.length){var s,a,p,u=e.params[t.length];if(u.varArgs){for(a=u.clone(),s=0;s<A.conversions.length;s++)if(p=A.conversions[s],!l(u.types,p.from)&&l(u.types,p.to)){var h=a.types.length;a.types[h]=p.from,a.conversions[h]=p}r(e,t.concat(a))}else{for(s=0;s<u.types.length;s++)r(e,t.concat(new o(u.types[s])));for(s=0;s<A.conversions.length;s++)p=A.conversions[s],!l(u.types,p.from)&&l(u.types,p.to)&&(a=new o(p.from),a.conversions[0]=p,r(e,t.concat(a)))}}else n.push(new i(t,e.fn))}var n=[];return r(this,[]),n},i.compare=function(r,n){if(r.params.length>n.params.length)return 1;if(r.params.length<n.params.length)return-1;var e,t=r.params.length,s=0,i=0;for(e=0;t>e;e++)r.params[e].hasConversions()&&s++,n.params[e].hasConversions()&&i++;if(s>i)return 1;if(i>s)return-1;for(e=0;e<r.params.length;e++){var a=o.compare(r.params[e],n.params[e]);if(0!==a)return a}return 0},i.prototype.hasConversions=function(){for(var r=0;r<this.params.length;r++)if(this.params[r].hasConversions())return!0;return!1},i.prototype.ignore=function(){for(var r={},n=0;n<A.ignore.length;n++)r[A.ignore[n]]=!0;for(n=0;n<this.params.length;n++)if(this.params[n].contains(r))return!0;return!1},i.prototype.toCode=function(r,n){for(var e=[],t=new Array(this.params.length),s=0;s<this.params.length;s++){var o=this.params[s],i=o.conversions[0];o.varArgs?t[s]="varArgs":i?t[s]=r.add(i.convert,"convert")+"(arg"+s+")":t[s]="arg"+s}var a=this.fn?r.add(this.fn,"signature"):void 0;return a?n+"return "+a+"("+t.join(", ")+"); // signature: "+this.params.join(", "):e.join("\n")},i.prototype.toString=function(){return this.params.join(", ")},a.prototype.toCode=function(r,e,t){var s=[];if(this.param){var o=this.path.length-1,i=this.param.conversions[0],a="// type: "+(i?i.from+" (convert to "+i.to+")":this.param);if(this.param.varArgs)if(this.param.anyType)s.push(e+"if (arguments.length > "+o+") {"),s.push(e+"  var varArgs = [];"),s.push(e+"  for (var i = "+o+"; i < arguments.length; i++) {"),s.push(e+"    varArgs.push(arguments[i]);"),s.push(e+"  }"),s.push(this.signature.toCode(r,e+"  ")),s.push(e+"}");else{for(var p=function(e,t){for(var s=[],o=0;o<e.length;o++)s[o]=r.add(n(e[o]),"test")+"("+t+")";return s.join(" || ")}.bind(this),u=this.param.types,h=[],f=0;f<u.length;f++)void 0===this.param.conversions[f]&&h.push(u[f]);s.push(e+"if ("+p(u,"arg"+o)+") { "+a),s.push(e+"  var varArgs = [arg"+o+"];"),s.push(e+"  for (var i = "+(o+1)+"; i < arguments.length; i++) {"),s.push(e+"    if ("+p(h,"arguments[i]")+") {"),s.push(e+"      varArgs.push(arguments[i]);");for(var f=0;f<u.length;f++){var c=this.param.conversions[f];if(c){var g=r.add(n(u[f]),"test"),v=r.add(c.convert,"convert");s.push(e+"    }"),s.push(e+"    else if ("+g+"(arguments[i])) {"),s.push(e+"      varArgs.push("+v+"(arguments[i]));")}}s.push(e+"    } else {"),s.push(e+"      throw createError(name, arguments.length, i, arguments[i], '"+h.join(",")+"');"),s.push(e+"    }"),s.push(e+"  }"),s.push(this.signature.toCode(r,e+"  ")),s.push(e+"}")}else if(this.param.anyType)s.push(e+"// type: any"),s.push(this._innerCode(r,e,t));else{var l=this.param.types[0],g="any"!==l?r.add(n(l),"test"):null;s.push(e+"if ("+g+"(arg"+o+")) { "+a),s.push(this._innerCode(r,e+"  ",t)),s.push(e+"}")}}else s.push(this._innerCode(r,e,t));return s.join("\n")},a.prototype._innerCode=function(r,n,e){var t,s=[];this.signature&&(s.push(n+"if (arguments.length === "+this.path.length+") {"),s.push(this.signature.toCode(r,n+"  ")),s.push(n+"}"));var o;for(t=0;t<this.childs.length;t++)if(this.childs[t].param.anyType){o=this.childs[t];break}for(t=0;t<this.childs.length;t++)s.push(this.childs[t].toCode(r,n,o));e&&!this.param.anyType&&s.push(e.toCode(r,n,o));var i=this._exceptions(r,n);return i&&s.push(i),s.join("\n")},a.prototype._exceptions=function(r,n){var e=this.path.length;if(0===this.childs.length)return[n+"if (arguments.length > "+e+") {",n+"  throw createError(name, arguments.length, "+e+", arguments["+e+"]);",n+"}"].join("\n");for(var t={},s=[],o=0;o<this.childs.length;o++){var i=this.childs[o];if(i.param)for(var a=0;a<i.param.types.length;a++){var p=i.param.types[a];p in t||i.param.conversions[a]||(t[p]=!0,s.push(p))}}return n+"throw createError(name, arguments.length, "+e+", arguments["+e+"], '"+s.join(",")+"');"};var d=[{name:"number",test:function(r){return"number"==typeof r}},{name:"string",test:function(r){return"string"==typeof r}},{name:"boolean",test:function(r){return"boolean"==typeof r}},{name:"Function",test:function(r){return"function"==typeof r}},{name:"Array",test:Array.isArray},{name:"Date",test:function(r){return r instanceof Date}},{name:"RegExp",test:function(r){return r instanceof RegExp}},{name:"Object",test:function(r){return"object"==typeof r}},{name:"null",test:function(r){return null===r}},{name:"undefined",test:function(r){return void 0===r}}],w={},x=[],j=[],A={config:w,types:d,conversions:x,ignore:j};return A=c("typed",{Object:function(r){var n=[];for(var t in r)r.hasOwnProperty(t)&&n.push(r[t]);var s=e(n);return c(s,r)},"string, Object":c,"...Function":function(r){for(var n,t=e(r),s={},o=0;o<r.length;o++){var i=r[o];if("object"!=typeof i.signatures)throw n=new TypeError("Function is no typed-function (index: "+o+")"),n.data={index:o},n;for(var a in i.signatures)if(i.signatures.hasOwnProperty(a))if(s.hasOwnProperty(a)){if(i.signatures[a]!==s[a])throw n=new Error('Signature "'+a+'" is defined twice'),n.data={signature:a},n}else s[a]=i.signatures[a]}return c(t,s)}}),A.config=w,A.types=d,A.conversions=x,A.ignore=j,A.create=r,A.find=y,A.convert=m,A.addType=function(r){if(!r||"string"!=typeof r.name||"function"!=typeof r.test)throw new TypeError("Object with properties {name: string, test: function} expected");A.types.push(r)},A.addConversion=function(r){if(!r||"string"!=typeof r.from||"string"!=typeof r.to||"function"!=typeof r.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");A.conversions.push(r)},A}return r()});